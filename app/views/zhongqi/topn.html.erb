<html>
<head>
  <title>一刀砍掉1500元，砍到0元MacBook就是你的啦，快召集朋友来帮你砍吧。</title>
  <link href="/kan.css?<%=Time.now.to_i%>" media="all" rel="stylesheet" type="text/css">
  <%= csrf_meta_tags %>    
  <script>
    function isWeiXin(){ 
     var useragent = navigator.userAgent;
     if (useragent.match(/MicroMessenger/i) != 'MicroMessenger') {
        // 这里警告框会阻塞当前页面继续加载
        alert('已禁止本次访问：您必须使用微信内置浏览器访问本页面！');
        // 以下代码是用javascript强行关闭当前页面
        var opened = window.open('about:blank', '_self');
        opened.opener = null;
        opened.close();
      }
    }     
    
    function onBridgeReady(){
     isWeiXin();
    }
    // 当微信内置浏览器完成内部初始化后会触发WeixinJSBridgeReady事件。
    if (typeof WeixinJSBridge == "undefined"){
        if( document.addEventListener ){
            document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
        }else if (document.attachEvent){
            document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
            document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
        }
    }else{
        onBridgeReady();
    }
  </script>
</head>
<body>
  <div id="content" class="bg-gray">
    <h1 class="center tag">砍价英雄榜</h1>
    <div class="kan-section">
      <% if @topn.empty? %>
        <p>您是第一个，抢先玩！</p>
      <% else %>
        <p>已有<%=@topn.size%>位微信用户发起了砍价活动!</p>
        <table>
            <thead>
                <tr>
                    <th>微信号</th>
                    <th>发起时间</th>                    
                    <th>砍掉金额</th>
                    <th>砍后价格</th>
                </tr>
            </thead>
            <tbody>
              <% @topn.each_with_index do |r,idx| %>
                <tr>
                  <td>#<%="#{idx+1} #{r[0]}"%></td>
                  <td><%= r[1] %></td>                  
                  <td><del><%=r[2]%></del></td>
                  <td><%=r[3]%></td>
                </tr>
              <%end%>
            </tbody>
        </table>
        <%end%>
    </div>
</body>
</html>
